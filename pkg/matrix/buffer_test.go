package matrix

import (
	"fmt"
	"slices"
	"testing"
)

func Test_Matrix_Buffer_Quadrant_1(t *testing.T) {
	testCases := []struct {
		ogn Bucket
		buf []Bucket
	}{
		// Case 000
		{
			ogn: Bucket{100, 100, 100, 100},
			buf: []Bucket{
				{100, 100, 100, 101}, {100, 100, 101, 101},
				{100, 100, 100, 100}, {100, 100, 101, 100},
			},
		},
		// Case 001
		{
			ogn: Bucket{100, 100, 101, 100},
			buf: []Bucket{
				{100, 100, 101, 101}, {100, 100, 102, 101},
				{100, 100, 101, 100}, {100, 100, 102, 100},
			},
		},
		// Case 002
		{
			ogn: Bucket{115, 123, 107, 101},
			buf: []Bucket{
				{115, 123, 107, 102}, {115, 123, 108, 102},
				{115, 123, 107, 101}, {115, 123, 108, 101},
			},
		},
		// Case 003
		{
			ogn: Bucket{115, 122, 107, 163},
			buf: []Bucket{
				{115, 123, 107, 100}, {115, 123, 108, 100},
				{115, 122, 107, 163}, {115, 122, 108, 163},
			},
		},
		// Case 004
		{
			ogn: Bucket{115, 123, 107, 100},
			buf: []Bucket{
				{115, 123, 107, 101}, {115, 123, 108, 101},
				{115, 123, 107, 100}, {115, 123, 108, 100},
			},
		},
		// Case 005
		{
			ogn: Bucket{115, 123, 163, 163},
			buf: []Bucket{
				{115, 124, 163, 100}, {116, 124, 100, 100},
				{115, 123, 163, 163}, {116, 123, 100, 163},
			},
		},
		// Case 006
		{
			ogn: Bucket{115, 123, 100, 100},
			buf: []Bucket{
				{115, 123, 100, 101}, {115, 123, 101, 101},
				{115, 123, 100, 100}, {115, 123, 101, 100},
			},
		},
		// Case 007
		{
			ogn: Bucket{114, 122, 163, 163},
			buf: []Bucket{
				{114, 123, 163, 100}, {115, 123, 100, 100},
				{114, 122, 163, 163}, {115, 122, 100, 163},
			},
		},
		// Case 008
		{
			ogn: Bucket{162, 162, 163, 163},
			buf: []Bucket{
				{162, 163, 163, 100}, {163, 163, 100, 100},
				{162, 162, 163, 163}, {163, 162, 100, 163},
			},
		},
		// Case 009
		{
			ogn: Bucket{163, 163, 163, 163},
			buf: []Bucket{
				{163, 164, 163, 100}, {164, 164, 100, 100},
				{163, 163, 163, 163}, {164, 163, 100, 163},
			},
		},
	}

	for i, tc := range testCases {
		t.Run(fmt.Sprintf("%03d", i), func(t *testing.T) {
			buf := Buffer(tc.ogn, 0x01)

			if !slices.Equal(buf[:], tc.buf) {
				t.Fatal("expected", tc.buf, "got", buf)
			}
		})
	}
}

func Test_Matrix_Buffer_Quadrant_2(t *testing.T) {
	testCases := []struct {
		ogn Bucket
		buf []Bucket
	}{
		// Case 000
		{
			ogn: Bucket{100, 100, 100, 100},
			buf: []Bucket{
				{100, 100, 100, 100}, {100, 100, 101, 100},
				{100, 99, 100, 163}, {100, 99, 101, 163},
			},
		},
		// Case 001
		{
			ogn: Bucket{100, 100, 101, 100},
			buf: []Bucket{
				{100, 100, 101, 100}, {100, 100, 102, 100},
				{100, 99, 101, 163}, {100, 99, 102, 163},
			},
		},
		// Case 002
		{
			ogn: Bucket{115, 123, 107, 101},
			buf: []Bucket{
				{115, 123, 107, 101}, {115, 123, 108, 101},
				{115, 123, 107, 100}, {115, 123, 108, 100},
			},
		},
		// Case 003
		{
			ogn: Bucket{115, 122, 107, 163},
			buf: []Bucket{
				{115, 122, 107, 163}, {115, 122, 108, 163},
				{115, 122, 107, 162}, {115, 122, 108, 162},
			},
		},
		// Case 004
		{
			ogn: Bucket{115, 123, 107, 100},
			buf: []Bucket{
				{115, 123, 107, 100}, {115, 123, 108, 100},
				{115, 122, 107, 163}, {115, 122, 108, 163},
			},
		},
		// Case 005
		{
			ogn: Bucket{115, 123, 163, 163},
			buf: []Bucket{
				{115, 123, 163, 163}, {116, 123, 100, 163},
				{115, 123, 163, 162}, {116, 123, 100, 162},
			},
		},
		// Case 006
		{
			ogn: Bucket{115, 123, 100, 100},
			buf: []Bucket{
				{115, 123, 100, 100}, {115, 123, 101, 100},
				{115, 122, 100, 163}, {115, 122, 101, 163},
			},
		},
		// Case 007
		{
			ogn: Bucket{115, 123, 100, 100},
			buf: []Bucket{
				{115, 123, 100, 100}, {115, 123, 101, 100},
				{115, 122, 100, 163}, {115, 122, 101, 163},
			},
		},
		// Case 008
		{
			ogn: Bucket{114, 122, 163, 163},
			buf: []Bucket{
				{114, 122, 163, 163}, {115, 122, 100, 163},
				{114, 122, 163, 162}, {115, 122, 100, 162},
			},
		},
	}

	for i, tc := range testCases {
		t.Run(fmt.Sprintf("%03d", i), func(t *testing.T) {
			buf := Buffer(tc.ogn, 0x02)

			if !slices.Equal(buf[:], tc.buf) {
				t.Fatal("expected", tc.buf, "got", buf)
			}
		})
	}
}

func Test_Matrix_Buffer_Quadrant_3(t *testing.T) {
	testCases := []struct {
		ogn Bucket
		buf []Bucket
	}{
		// Case 000
		{
			ogn: Bucket{100, 100, 100, 100},
			buf: []Bucket{
				{99, 100, 163, 100}, {100, 100, 100, 100},
				{99, 99, 163, 163}, {100, 99, 100, 163},
			},
		},
		// Case 001
		{
			ogn: Bucket{100, 100, 101, 100},
			buf: []Bucket{
				{100, 100, 100, 100}, {100, 100, 101, 100},
				{100, 99, 100, 163}, {100, 99, 101, 163},
			},
		},
		// Case 002
		{
			ogn: Bucket{115, 123, 107, 101},
			buf: []Bucket{
				{115, 123, 106, 101}, {115, 123, 107, 101},
				{115, 123, 106, 100}, {115, 123, 107, 100},
			},
		},
		// Case 003
		{
			ogn: Bucket{115, 122, 107, 163},
			buf: []Bucket{
				{115, 122, 106, 163}, {115, 122, 107, 163},
				{115, 122, 106, 162}, {115, 122, 107, 162},
			},
		},
		// Case 004
		{
			ogn: Bucket{115, 123, 107, 100},
			buf: []Bucket{
				{115, 123, 106, 100}, {115, 123, 107, 100},
				{115, 122, 106, 163}, {115, 122, 107, 163},
			},
		},
		// Case 005
		{
			ogn: Bucket{115, 123, 163, 163},
			buf: []Bucket{
				{115, 123, 162, 163}, {115, 123, 163, 163},
				{115, 123, 162, 162}, {115, 123, 163, 162},
			},
		},
		// Case 006
		{
			ogn: Bucket{115, 123, 100, 100},
			buf: []Bucket{
				{114, 123, 163, 100}, {115, 123, 100, 100},
				{114, 122, 163, 163}, {115, 122, 100, 163},
			},
		},
		// Case 007
		{
			ogn: Bucket{115, 123, 100, 100},
			buf: []Bucket{
				{114, 123, 163, 100}, {115, 123, 100, 100},
				{114, 122, 163, 163}, {115, 122, 100, 163},
			},
		},
		// Case 008
		{
			ogn: Bucket{114, 122, 163, 163},
			buf: []Bucket{
				{114, 122, 162, 163}, {114, 122, 163, 163},
				{114, 122, 162, 162}, {114, 122, 163, 162},
			},
		},
	}

	for i, tc := range testCases {
		t.Run(fmt.Sprintf("%03d", i), func(t *testing.T) {
			buf := Buffer(tc.ogn, 0x03)

			if !slices.Equal(buf[:], tc.buf) {
				t.Fatal("expected", tc.buf, "got", buf)
			}
		})
	}
}

func Test_Matrix_Buffer_Quadrant_4(t *testing.T) {
	testCases := []struct {
		ogn Bucket
		buf []Bucket
	}{
		// Case 000
		{
			ogn: Bucket{100, 100, 100, 100},
			buf: []Bucket{
				{99, 100, 163, 101}, {100, 100, 100, 101},
				{99, 100, 163, 100}, {100, 100, 100, 100},
			},
		},
		// Case 001
		{
			ogn: Bucket{100, 100, 101, 100},
			buf: []Bucket{
				{100, 100, 100, 101}, {100, 100, 101, 101},
				{100, 100, 100, 100}, {100, 100, 101, 100},
			},
		},
		// Case 002
		{
			ogn: Bucket{115, 123, 107, 101},
			buf: []Bucket{
				{115, 123, 106, 102}, {115, 123, 107, 102},
				{115, 123, 106, 101}, {115, 123, 107, 101},
			},
		},
		// Case 003
		{
			ogn: Bucket{115, 122, 107, 163},
			buf: []Bucket{
				{115, 123, 106, 100}, {115, 123, 107, 100},
				{115, 122, 106, 163}, {115, 122, 107, 163},
			},
		},
		// Case 004
		{
			ogn: Bucket{115, 123, 107, 100},
			buf: []Bucket{
				{115, 123, 106, 101}, {115, 123, 107, 101},
				{115, 123, 106, 100}, {115, 123, 107, 100},
			},
		},
		// Case 005
		{
			ogn: Bucket{115, 123, 163, 163},
			buf: []Bucket{
				{115, 124, 162, 100}, {115, 124, 163, 100},
				{115, 123, 162, 163}, {115, 123, 163, 163},
			},
		},
		// Case 006
		{
			ogn: Bucket{115, 123, 100, 100},
			buf: []Bucket{
				{114, 123, 163, 101}, {115, 123, 100, 101},
				{114, 123, 163, 100}, {115, 123, 100, 100},
			},
		},
		// Case 007
		{
			ogn: Bucket{115, 123, 100, 100},
			buf: []Bucket{
				{114, 123, 163, 101}, {115, 123, 100, 101},
				{114, 123, 163, 100}, {115, 123, 100, 100},
			},
		},
		// Case 008
		{
			ogn: Bucket{114, 122, 163, 163},
			buf: []Bucket{
				{114, 123, 162, 100}, {114, 123, 163, 100},
				{114, 122, 162, 163}, {114, 122, 163, 163},
			},
		},
	}

	for i, tc := range testCases {
		t.Run(fmt.Sprintf("%03d", i), func(t *testing.T) {
			buf := Buffer(tc.ogn, 0x04)

			if !slices.Equal(buf[:], tc.buf) {
				t.Fatal("expected", tc.buf, "got", buf)
			}
		})
	}
}

func Benchmark_Matrix_Buffer(b *testing.B) {
	testCases := []struct {
		ogn Bucket
		qdr byte
	}{
		// Case 000, ~4.50 ns/op
		{
			ogn: Bucket{100, 100, 100, 100},
			qdr: 0x01,
		},
		// Case 001, ~4.50 ns/op
		{
			ogn: Bucket{100, 100, 101, 100},
			qdr: 0x02,
		},
		// Case 002, ~4.50 ns/op
		{
			ogn: Bucket{115, 123, 107, 101},
			qdr: 0x03,
		},
		// Case 003, ~4.50 ns/op
		{
			ogn: Bucket{115, 122, 107, 163},
			qdr: 0x04,
		},
		// Case 004, ~4.50 ns/op
		{
			ogn: Bucket{115, 123, 107, 100},
			qdr: 0x01,
		},
		// Case 005, ~4.50 ns/op
		{
			ogn: Bucket{115, 123, 163, 163},
			qdr: 0x02,
		},
		// Case 006, ~4.50 ns/op
		{
			ogn: Bucket{115, 123, 100, 100},
			qdr: 0x03,
		},
		// Case 007, ~4.50 ns/op
		{
			ogn: Bucket{115, 123, 100, 100},
			qdr: 0x04,
		},
		// Case 008, ~4.50 ns/op
		{
			ogn: Bucket{114, 122, 163, 163},
			qdr: 0x01,
		},
		// Case 009, ~4.50 ns/op
		{
			ogn: Bucket{114, 122, 163, 163},
			qdr: 0x02,
		},
		// Case 010, ~4.50 ns/op
		{
			ogn: Bucket{162, 162, 163, 163},
			qdr: 0x03,
		},
		// Case 011, ~4.50 ns/op
		{
			ogn: Bucket{163, 163, 163, 163},
			qdr: 0x04,
		},
	}

	for i, tc := range testCases {
		b.Run(fmt.Sprintf("%03d", i), func(b *testing.B) {
			b.ResetTimer()
			for i := 0; i < b.N; i++ {
				Buffer(tc.ogn, tc.qdr)
			}
		})
	}
}
